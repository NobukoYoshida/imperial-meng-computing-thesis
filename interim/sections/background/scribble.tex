\section{The Scribble Language}

\subsection{Overview}
% Introduce Scribble as an implementation of MPST


% Protocol specification: show parallels between Scribble protocol and MPST global type

\begin{lstlisting}[language=Java,numbers=left,frame=single]
// TODO: Adder Protocol
\end{lstlisting}

\[
\begin{array}{rl}
G = \mu\mathbf{t}.\parti{Client}\to\parti{Server}:\{
& \text{Add}(\texttt{int}, \texttt{int}): \parti{Server}\to\parti{Client}: \{\text{Res}(\texttt{int}): \mathbf{t}\}, \\
& \text{Quit}(): \parti{Server}\to\parti{Client}: \{\text{Terminate}(): \mathbf{end}\}\\
\} &
\end{array}
\]


\subsection{Endpoint Finite State Machines}
\begin{itemize}
\item Show parallels between Scribble protocol-to-EFSM and MPST global-to-local projections
\item Formalise syntax and properties of EFSM derived from well-formed protocols
\end{itemize}

\begin{figure}[!hb]
\doublespacing
\[
\begin{array}{rlr}

\text{EFSM} ::= & \mathbb{R} \times \mathbb{L} \times \mathbb{T} \times \Sigma \times \mathbb{S} \times \delta & \text{Endpoint FSM} \\

\mathbb{R} ::= & r,~r',~\dots & \text{Role Identifiers} \\

\mathbb{L} ::= & l,~l',~\dots & \text{Message Label Identifiers} \\

\mathbb{T} ::= & \texttt{int},~\texttt{bool},~T,~T',~\dots & \text{Payload Format Types} \\

\Sigma ::= & & \text{Actions} \\
     & r!l(\tilde{T}) \quad \text{where } \tilde{T} \subseteq \mathbb{T} & \text{Output} \\
\mid & r?l(\tilde{T}) \quad \text{where } \tilde{T} \subseteq \mathbb{T} & \text{Input} \\

\mathbb{S} ::= & S,~S',\dots & \text{State Identifiers} \\

\delta ::= & \mathbb{S} \times \Sigma \rightharpoonup \mathbb{S} & \text{State Transition Function} \\

\end{array}
\]
\singlespacing
\caption{Syntax for Endpoint FSM}
\end{figure}

\begin{figure}[!hb]
\doublespacing
\[
\begin{array}{rl}

\texttt{initial}_{\mathbb{R}, \mathbb{L}, \mathbb{T}, \Sigma, \mathbb{S}, \delta}(S) \iff & \nexists S' \in \mathbb{S},\alpha \in \Sigma.~\delta(S',\alpha) = S \\
\texttt{terminal}_{\mathbb{R}, \mathbb{L}, \mathbb{T}, \Sigma, \mathbb{S}, \delta}(S) \iff & \delta(S) = \emptyset \\
\texttt{output}_{\mathbb{R}, \mathbb{L}, \mathbb{T}, \Sigma, \mathbb{S}, \delta}(S) \iff & \delta(S) = \{\,\alpha \in \Sigma \mid \exists r \in \mathbb{R}, l \in \mathbb{L}, \tilde{T} \subseteq{\mathbb{T}}.~\alpha = r!l(\tilde{T})\,\} \\
\texttt{input}_{\mathbb{R}, \mathbb{L}, \mathbb{T}, \Sigma, \mathbb{S}, \delta}(S) \iff & \delta(S) = \{\,\alpha \in \Sigma \mid \exists r \in \mathbb{R}, l \in \mathbb{L}, \tilde{T} \subseteq{\mathbb{T}}.~\alpha = r?l(\tilde{T})\,\} \\
\end{array}
\]
\singlespacing
\caption{Types of EFSM States}
\end{figure}
